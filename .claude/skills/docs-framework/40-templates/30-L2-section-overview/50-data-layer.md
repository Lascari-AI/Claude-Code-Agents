---
covers: Template for documenting database models, repositories, and persistence logic.
concepts: [L2, data, models, database, persistence, repository]
---

# Data Layer Overview Template

Template for documenting persistence concerns — database models, repositories, query patterns, and data access. Emphasizes entity relationships, constraints, and query patterns.

---

## When to Use

- Database models and schemas
- Repository/DAO layers
- Data access patterns
- Migration documentation

## Template

<template>

    ---
    covers: [Data layer name] — [one sentence describing what data it manages]
    type: overview
    concepts: [data, models, database, persistence]
    ---

    # [Data Layer Name]

    [One sentence: what data this layer manages and its role in the system.]

    ---

    ## Overview

    [1-2 paragraphs on the data architecture. What database(s)? What's the persistence strategy? Any important patterns (event sourcing, CQRS, etc.)?]

    ## Entity Relationships

    ```
    ┌─────────────┐       ┌─────────────┐       ┌─────────────┐
    │   Entity A  │──────►│   Entity B  │◄──────│   Entity C  │
    │             │  1:N  │             │  N:1  │             │
    └─────────────┘       └─────────────┘       └─────────────┘
           │                    │
           │ 1:1                │ N:M
           ▼                    ▼
    ┌─────────────┐       ┌─────────────┐
    │   Entity D  │       │   Entity E  │
    └─────────────┘       └─────────────┘
    ```

    ## Core Entities

    ### [Entity A]

    [What this entity represents in business terms]

    ```python
    class EntityA(Base):
        __tablename__ = "entity_a"

        id: Mapped[UUID] = mapped_column(primary_key=True)
        name: Mapped[str] = mapped_column(String(255))
        status: Mapped[StatusEnum] = mapped_column(default=StatusEnum.ACTIVE)
        created_at: Mapped[datetime] = mapped_column(default=func.now())

        # Relationships
        entity_bs: Mapped[list["EntityB"]] = relationship(back_populates="entity_a")
    ```

    **Key Constraints:**
    - [Constraint 1, e.g., "name must be unique within tenant"]
    - [Constraint 2]

    ### [Entity B]

    [What this entity represents]

    ```python
    class EntityB(Base):
        # ...
    ```

    ## Query Patterns

    ### [Pattern: Fetch with Related Data]

    ```python
    # Example query
    stmt = (
        select(EntityA)
        .options(selectinload(EntityA.entity_bs))
        .where(EntityA.status == StatusEnum.ACTIVE)
    )
    ```

    **When to use**: [Scenario when this pattern applies]

    ### [Pattern: Filtered Aggregation]

    ```python
    # Example query
    stmt = (
        select(EntityA.status, func.count(EntityA.id))
        .group_by(EntityA.status)
    )
    ```

    ## Indexes

    | Table | Index | Columns | Purpose |
    |-------|-------|---------|---------|
    | entity_a | ix_entity_a_status | status | Filter by status |
    | entity_a | ix_entity_a_tenant | tenant_id, created_at | Tenant queries |

    ## Migration Patterns

    [Brief notes on how migrations are handled]

    - Migrations are in `migrations/versions/`
    - Use `alembic revision --autogenerate -m "description"`
    - Always review autogenerated migrations before applying

    ## File Tree

    ```
    docs/10-codebase/XX-data/
    ├── 00-overview.md          (this file)
    ├── 10-[entities].md        Entity documentation
    ├── 20-[queries].md         Query patterns
    └── 30-[migrations].md      Migration guide
    ```

    ## Contents

    ### [10-entities.md](10-entities.md)
    [What this document covers]

</template>

## Usage Guidelines

### Entity Relationships
Show the relationship diagram with cardinality (1:1, 1:N, N:M). This is often the most valuable part of data layer documentation.

### Core Entities
Show actual model code (simplified if needed). Include:
- Key fields
- Relationships
- Important constraints

### Query Patterns
Document common query patterns with working examples. Name the pattern so developers can find what they need.

### Indexes
Document non-obvious indexes. Explain why they exist.
